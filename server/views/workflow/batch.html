{{ define "workflow/batch.html" }}

{{ template "partials/page_header.html" .}}

<h2>Workflow Batch</h2>

<p>Run all of the directories listed in a spreadsheet through the same workflow. 
For more information, see DART's 
<a href="#Help/openExternal?url=https://aptrust.github.io/dart-docs/users/workflows/batch_jobs/">
batch workflow documentation.</a></p>

<form method="post" action="/workflows/batch/choose" id="{{ .Form.ID }}">

  {{ template "partials/input_select.html" dict "field" .form.Fields.WorkflowID }}

  <!-- // TODO: The input below should be some kind of file chooser -->

  {{ template "partials/input_text.html" dict "field" .form.Fields.PathToCSVFile }}
  
  <div class="bottom-buttons">
    <div class="pull-right">
      <button class="btn btn-primary" type="submit" role="button">Run</button>
    </div>
  </div>

</form>

{{ if .batchErrors }}
<div id="batchValidation">
  <h3>Errors</h3>
  <ul>
    {{ range $index, $error := .batchErrors }}
    <li>{{ $error }}</li>
    {{ end }}
  </ul>
</div>
{{ end }}


<div class="row" id="dartProcessContainer">

</div>

<div class="alert alert-warning" role="alert" id="batchRunning" style="display:none;">
  Leave DART open and stay on this page until all jobs in the batch are complete.
</div>

<div class="alert alert-success" role="alert" id="batchCompleted" style="display:none;">
  All jobs have completed. Check the results below.
</div>

<div class="container mt-2" id="workflowResults" style="display:none;">
  <h3>Results</h3>
</div>

<!-- 
This template contains the HTML and JavaScript to display
job details and progress.
-->
{{ template "partials/job_run.html" . }}

<script>
$( document ).ready(function() {
  var batchIsValid = {{ .batchIsValid }}
  var runBatchNow = {{ .runBatchNow }}
  if (batchIsValid && runBatchNow) {
    runJob('/jobs/run/', '{{ .job.ID }}')")
  }
});
</script>



{{ template "partials/page_footer.html" .}}

{{ end }}
