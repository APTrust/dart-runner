{{ define "job/packaging.html" }}

{{ template "partials/page_header.html" .}}

<h2>Packaging</h2>

<!--
<p>
    Note: Although this page displays a number of serialization formats,
    DART currently supports only the "None" and ".tar" formats. Additional
    formats will be coming soon.
</p>
-->

<!-- { {> bannerAlert message = alertMessage } } -->

<form method="post" action="/jobs/packaging/{{ .job.ID }}" id="{{ .job.ID }}">

  <div style="display: {{ if .job.WorkflowID }} none {{ else }} block {{ end }};">
    {{ template "partials/input_select.html" dict "field" .form.Fields.PackageFormat }}

    <!-- div id="jobProfileContainer" style='display: {{if eq "BagIt" .form.Fields.PackageFormat.Value }} block {{ else }} none {{ end }};' -->
    <div id="jobProfileContainer" style='display:block;'>
        {{ template "partials/input_select.html" dict "field" .form.Fields.BagItProfileID }}
        {{ template "partials/input_select.html" dict "field" .form.Fields.BagItSerialization }}
    </div>
  </div>


  {{ template "partials/input_text.html" dict "field" .form.Fields.PackageName }}

  {{ template "partials/input_text.html" dict "field" .form.Fields.OutputPath }}

  {{ template "partials/input_hidden.html" dict "field" .form.Fields.ID }}

  <input type="hidden" name="direction" value="next"/>


  <div class="float-left" id="btnBackDiv">
    <button type="submit" onclick="document.forms['{{ .job.ID }}'].direction.value='previous'" class="btn btn-primary" role="button">&lt;&lt; Back</button>
  </div>
  
  <div class="float-right" id="btnNextDiv">
    <button type="submit" onclick="document.forms['{{ .job.ID }}'].direction.value='next'" class="btn btn-primary" role="button">Next &gt;&gt;</button>
  </div>
  

</form>

<script>
function setOutputPath() {
  var packageName = $('#Job_PackageName').val()
  var extension = $('#Job_BagItSerialization').val();
  if (packageName && !packageName.endsWith(extension)) {
    packageName += extension;
  }
  //if (extension == '') {
  //  packageName = packageName.replace(/\.\w+$/, '')
  //}
  var outputPath = $('#Job_OutputPath').val()
  var separator = "{{ .pathSeparator }}"
  var newOutputPath = ""
  if (outputPath.endsWith(separator)) {
    newOutputPath = outputPath + packageName
  } else {
    var pathComponents = outputPath.split(separator)
    pathComponents[pathComponents.length - 1] = packageName
    newOutputPath = pathComponents.join(separator)
  }
  $('#Job_OutputPath').val(newOutputPath)
}
$('#Job_PackageName').on('keyup', setOutputPath)
</script>

{{ template "partials/page_footer.html" .}}

{{ end }}